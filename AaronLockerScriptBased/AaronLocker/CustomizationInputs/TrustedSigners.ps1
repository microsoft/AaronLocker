<#
.SYNOPSIS
Customizable script used by Create-Policies.ps1 that identifies publishers or publisher+product/file combinations to trust.

.DESCRIPTION
TrustedSigners.ps1 outputs a sequence of hashtables that specify a label, and either a literal publisher name, or a path to a signed file to use as an example.

Each hashtable has a "label" property that is incorporated into the rule name and description.

Each hashtable also has either a "PublisherName" or an "exemplar" property:
* "PublisherName" is a literal canonical name identifying a publisher to trust.
  When using PublisherName, you can also add optional properties:
  * "ProductName", to restrict trust just to that product by that publisher; with "ProductName" you can also add "BinaryName" to restrict to a specific internal file name,
    and optionally then "FileVersion" as well to specify a minimum allowed file version.
    When using BinaryName, you should also specify an explicit RuleCollection, to reduce the number of rules. (E.g., no sense in having a Script rule allowing "MSVCP80.DLL".)
  * "RuleCollection", to apply the trust only within a single RuleCollection. RuleCollection must be one of "Exe", "Dll", "Script", or "Msi", and it is CASE-SENSITIVE.
* "exemplar" is the path to a signed file; the publisher to trust is extracted from that signature. When using exemplar, you can also add an optional "useProduct" boolean value indicating whether to restrict publisher trust only to that file's product name. If "useProduct" is not specified, all files signed by the publisher are trusted.

Examples showing possible combinations:

    # Trust everything by a specific publisher
    @{
    label = "Trust all Contoso";
    PublisherName = "O=CONTOSO, L=SEATTLE, S=WASHINGTON, C=US";
    }

    # Trust all DLLs by a specific publisher
    @{
    label = "Trust all Contoso DLLs";
    PublisherName = "O=CONTOSO, L=SEATTLE, S=WASHINGTON, C=US";
    RuleCollection = "Dll";
    }

    # Trust a specific product published by a specific publisher
    @{
    label = "Trust all CUSTOMAPP files published by Contoso";
    PublisherName = "O=CONTOSO, L=SEATTLE, S=WASHINGTON, C=US";
    ProductName = "CUSTOMAPP";
    }
    
    # Trust any version of a specific signed file by a specific publisher/product
    # RuleCollection must be one of Exe, Dll, Script, or Msi, and is CASE-SENSITIVE
    @{
    label = "Trust Contoso's SAMPLE.DLL in CUSTOMAPP";
    PublisherName = "O=CONTOSO, L=SEATTLE, S=WASHINGTON, C=US";
    ProductName = "CUSTOMAPP";
    BinaryName = "SAMPLE.DLL";
    FileVersion = "10.0.15063.0";
    RuleCollection = "Dll"; 
    }

    # Trust everything signed by the same publisher as the exemplar file (Autoruns.exe)
    @{
    label = "Trust the publisher of Autoruns.exe";
    exemplar = "C:\Program Files\Sysinternals\Autoruns.exe";
    }

    # Trust everything with the same publisher and product as the exemplar file (LuaBuglight.exe)
    @{
    label = "Trust everything with the same publisher and product as LuaBuglight.exe";
    exemplar = "C:\Program Files\Utils\LuaBuglight.exe";
    useProduct = $true
    }
#>

@{
# Allow Microsoft-signed OneDrive EXE and DLL files with the OneDrive product name; 
# This rule doesn't cover all of OneDrive's files because they include files from other products (Visual Studio, QT5, etc.)
label = "Microsoft OneDrive (partial)";
PublisherName = "O=MICROSOFT CORPORATION, L=REDMOND, S=WASHINGTON, C=US";
ProductName = "MICROSOFT ONEDRIVE";
}

@{
label = "Microsoft-signed MSI files";
RuleCollection = "Msi";
PublisherName = "O=MICROSOFT CORPORATION, L=REDMOND, S=WASHINGTON, C=US";
}

@{
# Windows' built-in troubleshooting often involves running Microsoft-signed scripts in the user's profile
label = "Microsoft-signed script files";
RuleCollection = "Script";
PublisherName = "O=MICROSOFT CORPORATION, L=REDMOND, S=WASHINGTON, C=US";
}

# Uncomment this block if Google Chrome is installed to ProgramFiles.
# Google Chrome runs some code in the user profile even when Chrome is installed to Program Files.
# This creates publisher rules that allow those components to run.
<#
    @{
    label = "Google Chrome SWReporter tool";
    RuleCollection = "Exe";
    PublisherName = "O=GOOGLE INC, L=MOUNTAIN VIEW, S=CALIFORNIA, C=US";
    ProductName = "SOFTWARE REPORTER TOOL";
    BinaryName = "SOFTWARE_REPORTER_TOOL.EXE";
    }
    @{
    label = "Google Chrome Cleanup";
    RuleCollection = "Dll";
    PublisherName = "O=ESET, SPOL. S R.O., L=BRATISLAVA, S=SLOVAKIA, C=SK";
    ProductName = "CHROME CLEANUP";
    }
    @{
    label = "Google Chrome Protector";
    RuleCollection = "Dll";
    PublisherName = "O=ESET, SPOL. S R.O., L=BRATISLAVA, S=SLOVAKIA, C=SK";
    ProductName = "CHROME PROTECTOR";
    }
#>

# Allow MSVC/MFC redistributable DLLs. Dot-source the MSVC/MFC DLL include file in this directory
. ([System.IO.Path]::Combine( [System.IO.Path]::GetDirectoryName($MyInvocation.MyCommand.Path), "TrustedSigners-MsvcMfc.ps1"))

